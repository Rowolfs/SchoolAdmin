generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id         Int      @id @default(autoincrement())
  email      String   @unique
  password   String
  roleId     Int
  name       String
  surname    String
  patronymic String

  role       Role     @relation(fields: [roleId], references: [id])
}

model Role {
  id    Int    @id @default(autoincrement())
  name  String @unique

  users User[]
}

model Class {
  id           Int    @id @default(autoincrement())
  classTeacher Int?   @unique // ðŸ‘ˆ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ð¾Ðµ scalar-Ð¿Ð¾Ð»Ðµ

  teacher      Teacher? @relation("ClassTeacher", fields: [classTeacher], references: [id])
  pupils       Pupil[]
  disciplines  ClassesDisciplines[]
}

model Teacher {
  id              Int    @id @default(autoincrement())
  classroomNumber String

  classClass      Class? @relation("ClassTeacher")
  disciplines     TeachersDisciplines[]
}

model Pupil {
  id        Int    @id @default(autoincrement())
  classId   Int

  class     Class  @relation(fields: [classId], references: [id])
  marks     DisciplinePupilsMark[]
}
model Discipline {
  id          Int    @id @default(autoincrement())
  name        String
  description String

  teachers    TeachersDisciplines[]
  classes     ClassesDisciplines[]
  marks       DisciplinePupilsMark[]
}

model TeachersDisciplines {
  teacherId    Int
  disciplineId Int

  teacher      Teacher    @relation(fields: [teacherId], references: [id])
  discipline   Discipline @relation(fields: [disciplineId], references: [id])

  @@id([teacherId, disciplineId])
}

model ClassesDisciplines {
  classId      Int
  disciplineId Int

  class        Class      @relation(fields: [classId], references: [id])
  discipline   Discipline @relation(fields: [disciplineId], references: [id])

  @@id([classId, disciplineId])
}

model DisciplinePupilsMark {
  disciplineId Int
  pupilId      Int
  mark         Int

  discipline   Discipline @relation(fields: [disciplineId], references: [id])
  pupil        Pupil      @relation(fields: [pupilId], references: [id])

  @@id([disciplineId, pupilId])
}
